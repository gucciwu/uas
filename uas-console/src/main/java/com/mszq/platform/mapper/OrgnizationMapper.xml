<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org/DTD Mapper 3.0" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.mszq.platform.app.orgnization.dao.IOrgnizationDAO">                                                     
   <resultMap id="BaseResultMap" type="com.mszq.platform.entity.Orgnization">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="id" jdbcType="BIGINT" property="id" />
    <result column="name" jdbcType="VARCHAR" property="name" />
    <result column="telephone" jdbcType="VARCHAR" property="telephone" />
    <result column="address" jdbcType="VARCHAR" property="address" />
    <result column="parent_orgnization_name" jdbcType="VARCHAR" property="parentOrgnizationName" />
    <result column="parent_orgnization_id" jdbcType="BIGINT" property="parentOrgnizationId" />
    <result column="create_time" jdbcType="TIMESTAMP" property="createTime" />
    <result column="update_time" jdbcType="TIMESTAMP" property="updateTime" />
    <result column="creator_id" jdbcType="BIGINT" property="creatorId" />
    <result column="register_code" jdbcType="VARCHAR" property="registerCode" />
    <result column="usci" jdbcType="VARCHAR" property="usci" />
    <result column="legal_representative" jdbcType="VARCHAR" property="legalRepresentative" />
    <result column="contacts" jdbcType="VARCHAR" property="contacts" />
    <result column="mobile" jdbcType="VARCHAR" property="mobile" />
    <result column="zip_code" jdbcType="VARCHAR" property="zipCode" />
    <result column="business_license" jdbcType="VARCHAR" property="businessLicense" />
    <result column="org_type" jdbcType="VARCHAR" property="orgType" />
  </resultMap>
	  <select id="queryAll" resultType="com.mszq.platform.entity.Orgnization">
			SELECT
				*
			FROM
				pf_sm_orgnization
		</select>
		
		<select id="queryByParams" parameterType="Map" resultType="com.mszq.platform.entity.Orgnization">
			SELECT
				*
			FROM
				pf_sm_orgnization where 1=1
				<if test="_parameter.containsKey('orgType')">  and org_type = #{orgType,jdbcType=VARCHAR}</if>
				<if test="_parameter.containsKey('name')">  and name like concat(#{name,jdbcType=VARCHAR},"%")</if>
		</select>
		
		<select id="selectParentOrgnizationById"  parameterType="java.lang.Long" resultType="com.mszq.platform.entity.Orgnization">
			SELECT
				id,parent_orgnization_id
			FROM
				pf_sm_orgnization where id=(
				select parent_orgnization_id from pf_sm_orgnization where id=#{id})
		</select>
		
		<select id="queryAllChildOrgnization"  parameterType="java.lang.Long" resultType="com.mszq.platform.entity.Orgnization">
			SELECT
				id,parent_orgnization_id
			FROM
				pf_sm_orgnization where parent_orgnization_id=#{id}
		</select>
		
		<select id="selectById"  parameterType="java.lang.Long" resultType="com.mszq.platform.entity.Orgnization">
			SELECT
				id,parent_orgnization_id
			FROM
				pf_sm_orgnization where id=#{id}
		</select>
  
	  <insert id="insert" parameterType="com.mszq.platform.entity.Orgnization" keyProperty="id" useGeneratedKeys="true">
	  	insert ignore into pf_sm_orgnization(name,telephone,address,parent_orgnization_name,parent_orgnization_id,register_code,usci,legal_representative,contacts,zip_code,business_license,update_time,org_type,mobile)
	  	values (#{name},#{telephone},#{address},#{parentOrgnizationName},#{parentOrgnizationId},#{registerCode},#{usci},#{legalRepresentative},#{contacts},#{zipCode},#{businessLicense},#{updateTime},#{orgType},#{mobile})
	  </insert>
       <select id="selectByName"   parameterType="java.lang.String" resultMap="BaseResultMap">
	    select 
	       *
	    from pf_sm_orgnization
	    where name = #{name}
       </select>
	    <select id="selectByRegisterCode" parameterType="java.lang.String" resultMap="BaseResultMap">
	    select 
	      *
	    from pf_sm_orgnization
	    where register_code = #{registerCode}
	  </select> 
	  <select id="getChildrenBykey" resultType="int">
	  	 select count(id) from pf_sm_orgnization where parent_orgnization_id IN
	     <foreach collection="array" item="id" open="(" close=")" separator=",">
	     	#{id}
	     </foreach>
	  </select>
	  
	  <select id="checkOrgnizationByNameOrRegisterCode" resultType="java.lang.Long">
	  	 select id from pf_sm_orgnization where register_code=#{registerCode}
	  </select>
	  
	  <delete id="deleteBatch">
	  	 delete from pf_sm_orgnization where id IN
	     <foreach collection="array" item="id" open="(" close=")" separator=",">
	     	#{id}
	     </foreach>
	  </delete>
	  
	  <delete id="deleteBatchByFids">
         delete from pf_sm_orgnization where register_code in (
	         select register_code from pp_financial_institution where id in 
	         <foreach collection="array" item="id" open="(" close=")" separator=",">
	            #{id}
	         </foreach>
         )
      </delete>

	  <update id="updateByPrimaryKey" parameterType="com.mszq.platform.entity.Orgnization" >
	    update pf_sm_orgnization
	    set   name = #{name},
		      address = #{address},
		      parent_orgnization_name = #{parentOrgnizationName},
		      parent_orgnization_id = #{parentOrgnizationId},
		      register_code = #{registerCode},
		      usci = #{usci},
		      legal_representative = #{legalRepresentative},
		      telephone = #{telephone},
		      mobile = #{mobile},
		      zip_code = #{zipCode},
		      business_license = #{businessLicense},
		      contacts = #{contacts},
		      update_time = #{updateTime,jdbcType=TIMESTAMP}
	    where id = #{id}
	  </update>
	  
	  <update id="updateByRegisterCode" parameterType="com.mszq.platform.entity.Orgnization" >
	    update pf_sm_orgnization
	    set   name = #{name},
		      address = #{address},
		      parent_orgnization_name = #{parentOrgnizationName},
		      parent_orgnization_id = #{parentOrgnizationId},
		      usci = #{usci},
		      legal_representative = #{legalRepresentative},
		      telephone = #{telephone},
		      mobile = #{mobile},
		      zip_code = #{zipCode},
		      business_license = #{businessLicense},
		      contacts = #{contacts},
		      update_time = #{updateTime,jdbcType=TIMESTAMP}
	    where register_code = #{registerCode}
	  </update>
	  
	    <!-- 快速搜索信息 --> 
    <select id="queryForCombo" parameterType="java.lang.String" resultType="com.mszq.platform.util.ComboOption">
  		select  mm.id value,
  				mm.name text
		   from pf_sm_orgnization mm
		  left join pf_sm_orgnization p on p.id =mm.parent_orgnization_id
			where p.name =#{orgName}
  	</select>  
	  
	  
</mapper>
